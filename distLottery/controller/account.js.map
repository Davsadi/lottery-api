{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","register","username","body","email","password","err","account","send","authenticate","session","status","scope","get","logout","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAC/B,QAAIC,MAAM,sBAAV;;AAEA;AACAA,QAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChC,0BAAQC,QAAR,CAAiB,sBAAY,EAAEC,UAAUH,IAAII,IAAJ,CAASC,KAArB,EAAZ,CAAjB,EAA4DL,IAAII,IAAJ,CAASE,QAArE,EAA+E,UAAUC,GAAV,EAAeC,OAAf,EAAwB;AACnG,gBAAID,GAAJ,EAAS;AACLN,oBAAIQ,IAAJ,CAASF,GAAT;AACH;AACD,+BAASG,YAAT,CACI,OADJ,EACa;AACLC,yBAAS;AADJ,aADb,EAGGX,GAHH,EAGQC,GAHR,EAGa,YAAM;AACfA,oBAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,kCAArB;AACH,aALD;AAMH,SAVD;AAWH,KAZD;;AAcA;AACAX,QAAIC,IAAJ,CAAS,QAAT,EAAmB,mBAASW,YAAT,CACf,OADe,EACN;AACLC,iBAAS,KADJ;AAELE,eAAO;AAFF,KADM,CAAnB;;AAOA;AACAf,QAAIgB,GAAJ,CAAQ,SAAR,gCAAiC,UAACd,GAAD,EAAMC,GAAN,EAAc;AAC3CA,YAAIc,MAAJ;AACAd,YAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,yBAArB;AACH,KAHD;;AAMAX,QAAIgB,GAAJ,CAAQ,KAAR,gCAA6B,UAACd,GAAD,EAAMC,GAAN,EAAc;AACvCA,YAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqBT,IAAIgB,IAAzB;AACH,KAFD;;AAIA,WAAOlB,GAAP;AACH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nexport default ({ config, db }) => {\n    let api = Router();\n\n    // '/v1/account/register' - REGISTER\n    api.post('/register', (req, res) => {\n        Account.register(new Account({ username: req.body.email }), req.body.password, function (err, account) {\n            if (err) {\n                res.send(err);\n            }\n            passport.authenticate(\n                'local', {\n                    session: false\n            })(req, res, () => {\n                res.status(200).send('successfully created new account');\n            });\n        });\n    });\n\n    // '/v1/account/login' - LOGIN\n    api.post('/login', passport.authenticate(\n        'local', {\n            session: false,\n            scope: []\n        }), generateAccessToken, respond);\n\n\n    // '/v1/account/logout' - LOGOUT\n    api.get('/logout', authenticate, (req, res) => {\n        res.logout();\n        res.status(200).send('successfully logged out');\n    });\n\n\n    api.get('/me', authenticate, (req, res) => {\n        res.status(200).send(req.user);\n    });\n\n    return api;\n}\n"]}